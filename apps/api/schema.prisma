generator client {
    provider        = "prisma-client-py"
    previewFeatures = ["multiSchema"]
    interface       = "asyncio"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
    schemas  = ["public", "storage"]
}

model buckets {
    id                         String                       @id
    name                       String                       @unique(map: "bname")
    owner                      String?                      @db.Uuid
    created_at                 DateTime?                    @default(now()) @db.Timestamptz(6)
    updated_at                 DateTime?                    @default(now()) @db.Timestamptz(6)
    public                     Boolean?                     @default(false)
    avif_autodetection         Boolean?                     @default(false)
    file_size_limit            BigInt?
    allowed_mime_types         String[]
    owner_id                   String?
    objects                    objects[]
    prefixes                   prefixes[]
    s3_multipart_uploads       s3_multipart_uploads[]
    s3_multipart_uploads_parts s3_multipart_uploads_parts[]

    @@schema("storage")
}

model migrations {
    id          Int       @id
    name        String    @unique @db.VarChar(100)
    hash        String    @db.VarChar(40)
    executed_at DateTime? @default(now()) @db.Timestamp(6)

    @@schema("storage")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model objects {
    id                   String                @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    bucket_id            String?
    name                 String?
    owner                String?               @db.Uuid
    created_at           DateTime?             @default(now()) @db.Timestamptz(6)
    updated_at           DateTime?             @default(now()) @db.Timestamptz(6)
    last_accessed_at     DateTime?             @default(now()) @db.Timestamptz(6)
    metadata             Json?
    path_tokens          String[]              @default(dbgenerated("string_to_array(name, '/'::text)"))
    version              String?
    owner_id             String?
    user_metadata        Json?
    level                Int?
    buckets              buckets?              @relation(fields: [bucket_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "objects_bucketId_fkey")
    processed_pdfs       processed_pdfs?
    processed_pdf_images processed_pdf_images?

    @@unique([bucket_id, name], map: "bucketid_objname")
    @@unique([name, bucket_id], map: "idx_name_bucket_unique")
    @@unique([bucket_id, level, name], map: "objects_bucket_id_level_idx")
    @@index([bucket_id, name], map: "idx_objects_bucket_id_name")
    @@index([name], map: "name_prefix_search")
    @@schema("storage")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model prefixes {
    bucket_id  String
    name       String
    level      Int       @default(dbgenerated("storage.get_level(name)"))
    created_at DateTime? @default(now()) @db.Timestamptz(6)
    updated_at DateTime? @default(now()) @db.Timestamptz(6)
    buckets    buckets   @relation(fields: [bucket_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "prefixes_bucketId_fkey")

    @@id([bucket_id, level, name])
    @@schema("storage")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model s3_multipart_uploads {
    id                         String                       @id
    in_progress_size           BigInt                       @default(0)
    upload_signature           String
    bucket_id                  String
    key                        String
    version                    String
    owner_id                   String?
    created_at                 DateTime                     @default(now()) @db.Timestamptz(6)
    user_metadata              Json?
    buckets                    buckets                      @relation(fields: [bucket_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
    s3_multipart_uploads_parts s3_multipart_uploads_parts[]

    @@index([bucket_id, key, created_at], map: "idx_multipart_uploads_list")
    @@schema("storage")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model s3_multipart_uploads_parts {
    id                   String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    upload_id            String
    size                 BigInt               @default(0)
    part_number          Int
    bucket_id            String
    key                  String
    etag                 String
    owner_id             String?
    version              String
    created_at           DateTime             @default(now()) @db.Timestamptz(6)
    buckets              buckets              @relation(fields: [bucket_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
    s3_multipart_uploads s3_multipart_uploads @relation(fields: [upload_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

    @@schema("storage")
}

enum annotation_type {
    url_citation

    @@schema("public")
}

enum image_detail {
    auto
    low
    high

    @@schema("public")
}

enum message_content_type {
    text
    image
    file
    tool_use
    tool_result

    @@schema("public")
}

enum message_role {
    developer
    system
    assistant
    user
    tool

    @@schema("public")
}

enum widget_type {
    text
    image
    image_url
    chart
    multiple_choice

    @@schema("public")
}

model threads {
    id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    external_id String?    @unique
    created_at  DateTime   @default(now())
    updated_at  DateTime   @default(now()) @updatedAt
    metadata    Json       @default("{}") @db.JsonB
    messages    messages[]

    @@map("threads")
    @@schema("public")
}

model messages {
    id          String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    thread      threads            @relation(fields: [thread_id], references: [id], onDelete: Cascade)
    thread_id   String             @db.Uuid
    role        message_role       @default(user)
    name        String?
    tool_use_id String?
    refusal     String?
    contents    message_contents[]
    agent_class String
    created_at  DateTime           @default(now())
    updated_at  DateTime           @default(now()) @updatedAt

    @@map("messages")
    @@schema("public")
}

model message_contents {
    id          String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    message     messages             @relation(fields: [message_id], references: [id], onDelete: Cascade)
    message_id  String               @db.Uuid
    type        message_content_type @default(text)
    image_url   String?
    file_data   Bytes?
    file_name   String?
    text        String?
    widget_type widget_type?
    tool_use_id String?
    tool_name   String?
    tool_input  Json?                @db.JsonB
    tool_output String?
    created_at  DateTime             @default(now())
    updated_at  DateTime             @default(now()) @updatedAt

    @@map("message_contents")
    @@schema("public")
}

model processed_pdfs {
    id               String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    long_summary     String
    short_summary    String
    markdown_content String
    file_type        String
    object_id        String                 @unique @db.Uuid
    object           objects                @relation(fields: [object_id], references: [id], onDelete: Cascade)
    images           processed_pdf_images[]
    created_at       DateTime               @default(now())
    updated_at       DateTime               @default(now()) @updatedAt

    @@map("processed_pdfs")
    @@schema("public")
}

model processed_pdf_images {
    id                 String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
    processed_pdf_id   String         @db.Uuid
    processed_pdf      processed_pdfs @relation(fields: [processed_pdf_id], references: [id], onDelete: Cascade)
    object_id          String         @unique @db.Uuid
    object             objects        @relation(fields: [object_id], references: [id], onDelete: Cascade)
    original_file_name String
    summary            String
    page               Int
    created_at         DateTime       @default(now())
    updated_at         DateTime       @default(now()) @updatedAt

    @@map("processed_pdf_images")
    @@schema("public")
}
